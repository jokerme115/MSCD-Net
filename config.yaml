# ==========================================
# DeepLabV3+ 腐烂区域检测配置文件
# ==========================================

# ==========================================
# 数据集相关配置
# ==========================================
data_root: "./datasets/data"
dataset: "cassava_rot"
# 类别数量
# 建议: 对于腐烂检测任务保持为2 (健康区域和腐烂区域)
# 调整建议: 除非修改了任务定义，否则不要更改
num_classes: 2
# 图像裁剪尺寸
# 建议: 较大的值有助于保留小目标细节，但会增加内存消耗
# 调整建议: 
#   - 内存充足时可设置为 768 或 1024
#   - 内存受限时可降低到 512 或 384
crop_size: 384
# 训练批次大小
# 建议: 根据GPU内存调整，较大的批次有助于稳定训练
# 调整建议:
#   - 高端GPU (>= 11GB): 可设置为 16 或更高
#   - 中端GPU (6-8GB): 建议设置为 8
#   - 入门级GPU (< 6GB): 建议设置为 4 或 2
batch_size: 4
# 验证批次大小
# 建议: 通常可以比训练批次稍大，因为不需要计算梯度
val_batch_size: 4


# 是否启用自注意力机制
# 建议: 启用以增强模型对全局上下文的建模能力
# 调整建议:
#   - True: 启用自注意力机制
#   - False: 禁用自注意力机制
use_attention: true

# 是否启用过采样
# 建议: 对于类别不平衡问题(腐烂区域较少)建议启用
# 调整建议: 
#   - True: 启用过采样，增强对腐烂区域的学习
#   - False: 禁用过采样，使用原始数据分布
oversample: true

# 过采样方法列表
# 可选值: none, default, smote, adasyn, borderline, smoteenn, smotetomek
# 建议: 
#   - default: 简单重复采样，适合快速实验
#   - smote: SMOTE算法，适合一般情况
#   - borderline: Borderline-SMOTE，适合边界样本较多的情况
#   - none: 不使用过采样
oversample_methods: 
  - "none"
  - "default"
  - "smote"
  - "smoteenn"
  - "smotetomek"

# ==========================================
# 模型相关配置
# ==========================================
# ==========================================
# 模型相关配置 (批量训练模式)
# ==========================================

# 骨干网络列表
# 可同时训练多个骨干网络以比较性能
# 支持的模型:
#   - deeplabv3plus_resnet18     # DeepLabV3+ with ResNet-18 backbone
#   - deeplabv3plus_resnet34     # DeepLabV3+ with ResNet-34 backbone
#   - deeplabv3plus_resnet50     # DeepLabV3+ with ResNet-50 backbone
#   - deeplabv3plus_resnet101    # DeepLabV3+ with ResNet-101 backbone
#   - deeplabv3plus_resnet152    # DeepLabV3+ with ResNet-152 backbone
#   - deeplabv3plus_mobilenet    # DeepLabV3+ with MobileNetv2 backbone
#   - deeplabv3plus_xception     # DeepLabV3+ with Xception backbone
#   - deeplabv3plus_hrnetv2_32   # DeepLabV3+ with HRNetV2-W32 backbone
#   - deeplabv3plus_hrnetv2_48   # DeepLabV3+ with HRNetV2-W48 backbone
# 建议: 
#   - 高精度要求: deeplabv3plus_resnet101 或 deeplabv3plus_xception
#   - 实时性要求: deeplabv3plus_mobilenet
#   - 平衡选择: deeplabv3plus_resnet50
#   - 轻量级选择: deeplabv3plus_resnet18
backbones:
  - deeplabv3plus_resnet101    # DeepLabV3+ with ResNet-101 backbone

# 是否使用可分离卷积
# 建议: 对于MobileNet和Xception默认为False，其他模型可设置为True以减少参数
separable_conv: false

# 输出步长
# 建议: 
#   - ResNet系列模型: 16
#   - MobileNet和Xception模型: 8
#   - HRNet模型: 4
# 调整建议: 较小的值可获得更高分辨率特征图，但计算量更大
output_stride: 16

# ==========================================
# 训练相关配置
# ==========================================

# 总迭代次数
# 建议: 根据数据集大小和模型复杂度调整
# 调整建议:
#   - 大数据集 + 复杂模型: 30000-50000
#   - 中等数据集 + 中等模型: 15000-30000
#   - 小数据集 + 简单模型: 10000-15000
total_itrs: 20

# 验证间隔
# 建议: 平衡训练效率和监控频率
# 调整建议:
#   - 训练时间充裕: 50-100
#   - 快速实验: 200-500
val_interval: 10

# 打印间隔
# 建议: 频繁监控有助于及时发现问题
# 调整建议:
#   - 高频监控: 10-50
#   - 低频监控: 100-200
print_interval: 10

# 学习率
# 建议: 根据批次大小和模型调整
# 调整建议:
#   - 大批次(>=16): 0.01-0.05
#   - 中等批次(8-16): 0.005-0.01
#   - 小批次(<8): 0.001-0.005
lr: 0.01

# GPU ID
# 建议: 根据可用GPU设置
# 调整建议: 多GPU训练时使用逗号分隔，如 "0,1"
gpu_id: "0"

# 学习率策略
# 可选值: 
#   - poly              # 多项式衰减
#   - step              # 阶梯衰减
#   - cosine_with_warmup # 余弦退火+预热
# 建议: 
#   - 解决假阳性问题: cosine_with_warmup
#   - 稳定训练: poly
lr_policy: "cosine_with_warmup"

# 阶梯衰减步长 (仅在lr_policy为step时使用)
step_size: 2000

# 预热步数 (仅在lr_policy为cosine_with_warmup时使用)
# 建议: 设置为总迭代次数的5-10%
warmup_steps: 200

# 预热初始学习率 (仅在lr_policy为cosine_with_warmup时使用)
# 建议: 设置为正常学习率的1/10到1/100
warmup_lr: 1e-6

# 冻结骨干网络的epoch数
# 建议: 对于预训练模型，可设置为几个epoch以稳定训练
# 调整建议:
#   - 从头训练: 0
#   - 微调: 5-20
freeze_backbone: 0

# 权重衰减
# 建议: 防止过拟合
# 调整建议:
#   - 小数据集: 1e-4
#   - 大数据集: 1e-5
weight_decay: 1e-4

# 随机种子
# 建议: 保持固定以确保实验可复现
random_seed: 1

# ==========================================
# 早停机制配置
# ==========================================

# 早停耐心值
# 建议: 根据验证间隔和训练稳定性调整
# 调整建议:
#   - 稳定训练: 5-10
#   - 波动较大训练: 10-20
early_stopping_patience: 15

# 早停最小改善阈值
# 建议: 根据指标数值范围设置
# 调整建议:
#   - IoU指标: 0.001-0.005
#   - 损失指标: 0.0001-0.001
early_stopping_delta: 0.001

# 是否启用详细日志
# 建议: 调试时启用，正式训练可禁用
early_stopping_verbose: true

# 是否恢复最佳权重
# 建议: 启用以确保使用最佳模型
early_stopping_restore_best_weights: true

# 早停模式
# 可选值:
#   - max: 监控需要最大化的指标（如IoU）
#   - min: 监控需要最小化的指标（如损失）
early_stopping_mode: "max"

# 移动平均窗口大小
# 建议: 平滑指标波动
# 调整建议:
#   - 不平滑: 1
#   - 轻度平滑: 3
#   - 强度平滑: 5
early_stopping_avg_window: 3

# 最小增量耐心轮次
# 建议: 在训练初期忽略delta阈值
# 调整建议:
#   - 无初期宽容: 0
#   - 轻度宽容: 10-20
#   - 强度宽容: 30-50
early_stopping_min_delta_patience: 30

# ==========================================
# 损失函数配置 (批量训练模式)
# ==========================================

# 损失函数列表
# 可同时训练多个损失函数以比较性能
# 可选值:
#   - ce_loss        # 标准交叉熵损失
#   - focal_loss     # Focal Loss，适用于类别不平衡问题
#   - dice_loss      # Dice Loss，适用于分割任务
#   - tversky        # Tversky Loss，可调节对假阳性和假阴性的敏感度
#   - combined       # 组合损失函数：Tversky Loss + Focal Loss
# 建议: 
#   - 解决假阳性问题: tversky 或 combined
#   - 一般任务: focal_loss
loss_functions:
  - "tversky"

# ==========================================
# 批量实验配置
# ==========================================

# 实验名称
# 建议: 根据实验目的命名，便于区分不同实验
experiment_name: "多种过采样方法对比"

# 是否显示详细信息
# 建议: 调试时设置为true，正式训练可设置为false
verbose: true

# ==========================================
# 其他配置
# ==========================================

# 测试模式 (仅进行测试，不训练)
# 建议: 
#   - True: 加载预训练模型进行测试
#   - False: 正常训练模式
test_only: false

# 恢复训练 (从检查点继续训练)
# 建议: 训练中断后恢复使用
continue_training: false

# 检查点路径 (用于恢复训练或测试)
# 建议: 指向之前保存的模型文件
ckpt: null

# 保存验证结果到指定目录
# 建议: 设置为具体路径以保存预测结果可视化
save_val_results_to: "./predict_results"

# 预测输入路径 (用于预测时指定输入图像路径)
# 可以是单个图像文件或包含图像的目录
predict_input: "./test"